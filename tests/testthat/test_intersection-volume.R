context("Simplex intersection: volume")

# Tests
X1 <- matrix(c(0., 0., 0., 1., 0., 0., 0., 1., 0., 0., 0., 1.),
            nrow = 3, ncol = 4)
Y1 <- matrix(c(0.864401, 0.12, -0.2, -0.902914, 2.21188, 1.85278,
              0.369714, 0.864401, 0.532813, -0.827763,
              0.0721164, 2.21188), nrow = 3, ncol = 4)

test_that("simplex volume is computed", {
  intersect_volume(X1, Y1)
})

X9 <- t(matrix(c(0.934702, 0.297735, 0.670881, 0.85225, 0.670881, 0.626323, 0.521743, 0.942819, 0.521743, 0.385638, 0.202466, 0.613331), nrow = 4, ncol = 3))
Y9 <- t(matrix(c(0.670881, 0.85225, 0.297735, 0.202466, 0.521743, 0.942819, 0.626323, 0.898955, 0.202466, 0.613331, 0.385638, 0.85225), nrow = 4, ncol = 3))
X10 <- t(matrix(c(0.385638, 0.297735, 0.353544, 0.202466, 0.353544, 0.626323, 0.444382, 0.898955, 0.444382, 0.385638, 0.235286, 0.85225), nrow = 4, ncol = 3))
Y10 <- t(matrix(c(0.353544, 0.235286, 0.297735, 0.202466, 0.444382, 0.822361, 0.626323, 0.898955, 0.235286, 0.934702, 0.385638, 0.85225), nrow = 4, ncol = 3))
X32 <- t(matrix(c(0.43164, 0.448155, 0.183749, 0.161536, 0.18939, 0.441274, 0.161536, 0.1, 0.167429, 0.449395, 0.1, 0.423904), nrow = 4, ncol = 3))
Y32 <- t(matrix(c(0.167429, 0.418747, 0.161536, 0.212626, 0.186739, 0.393982, 0.1, 0.232448, 0.163876, 0.212626, 0.423904, 0.285539), nrow = 4, ncol = 3))

test_that("volumes are correct", {
  expect_equal(intersect_volume(X9, Y9), 0.010081146644460765, tolerance = 1e-7)
  expect_equal(intersect_volume(X10, Y10), 0.0002709969231, tolerance = 1e-7)
  expect_equal(intersect_volume(X32, Y32), 0.0002325652, tolerance = 1e-7)
})
